#!/bin/bash
#::                             S Y S T E M    B U I L D     C O M P O N E N T
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#:::::::::::::::::::::::::::::::::::::::::::://   Setings File    //::::::::::::::::::::::::::::::::::// Linux //::::::::
#::
#:: Author:   	SLS
#:: Version 	1.0
#::
#::
#::	Purpose: To be a shared location for setings in regard to locations online and local.
#::
#::
#::
#::
#::
#::
#::
#::
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Location of all scripts and settings on the internet. This may be set as a variable "GIT_Profile"
# globally to override this setting here. It will default to a standard value if nothing is dpecified. 
# To forcibly use a given GIT profile replace everythig on the right of the = sign with your desired value.
# If you want to use a different default source, then replace the "vonschutter" with your preference.
GIT_Profile=${GIT_Profile:=vonschutter}
GIT_Theme_URL="https://github.com/${GIT_Profile}/RTD-Themes.git"
GIT_RTD_SETUP_BASE_URL="https://github.com/${GIT_Profile}/RTD-Setup/"
GIT_RTD_SRC_URL="https://github.com/${GIT_Profile}/RTD-Setup.git"

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Location of files and directories.
# All included scripts should respect these locations.
# These variable assignments attemt to detect the location of all relevant directories.

export _TLA=${_TLA:-"RTD"}                              # Three letter default acronym ID for the ORM or ORG
export _tla=${_TLA,,}                                   # Lowercase version of the three letter acronym
export _scriptdir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
export _OEM_DIR="${_OEM_DIR:-"/opt/${_TLA,,}"}"         # Root directory of tools
export _CACHE_DIR="${_OEM_DIR}/cache"                   # Caching and download folder
export _WALLPAPER_DIR="${_OEM_DIR}/wallpaper"           # Location of oem wallpapers
export _CUSTOM_SOUND_DIR="${_OEM_DIR}/sound"            # Location of custom sounds
export _THEME_DIR="${_OEM_DIR}/themes"                  # Location of installable themes
export _APP_DIR="${_OEM_DIR}/apps"                      # location of cusom apps (self contained)
export _MODS_DIR="${_OEM_DIR}/modules"                  # Location of all oem powertools extras
export _CORE_DIR="${_OEM_DIR}/core"            	        # Location of oem libraries and core functions
export _APPS_DIR="${_MODS_DIR}/oem-app-runner.mod/apps" # Location of 3rd party free apps that may be useful
export _LOG_DIR=/var/log/${_TLA,,}                      # Location of log files
export _CONFIG_DIR=/etc/${_TLA,,}                       # Location of status files and config files
export _OEM_TEST_IPS=("8.8.8.8" "1.1.1.1" "9.9.9.9")    # Location of test ip addresses
export _USER_HOME_DIR="$/home/$( if [[ -n $SUDO_USER ]]; then echo $SUDO_USER; else echo $USER; fi )"  # Location of user home directory
export _USER_CONFIG_DIR="${_USER_HOME_DIR}/.config/${_tla:-"rtd"}" # Location of user specific config files

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# default ID's to be used for system building and configuration
export _OEM_USER="tangarora"                            # Default user for building VM's (can be chagned, overridden, or set in the menu)
export _OEM_USER_FULL_NAME="Tangarora Rotorua"          # Default full name for CloudConfig and Preseed files (can be overidden)
export _OEM_USER_PASSWORD="letmein1234"                 # Default password for CloudConfig and Preseed files (please overide)


#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Locatilazations for the system. These are used to set the default language and keyboard layout (can be overidden)
export _OEM_USER_KEYBOARD_LAYOUT="us"                   # Default keyboard layout for CloudConfig and Preseed files (can be overidden)
export _OEM_USER_LANGUAGE="en_US"                       # Default language for CloudConfig and Preseed files (can be overidden)
export _OEM_TIME_ZONE="Etc/UTC"                         # Default time zone for CloudConfig and Preseed files (can be overidden)


#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Location of where to store completed software productivity bundles installed and where to find software 
# productivity bundles that are available for install. 
export completed_bundles_list="${_CONFIG_DIR}/completed-bundles.info"
export available_bundles_list="${_OEM_DIR}/core/_rtd_recipes.info"

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Location of where to find the latest oracle java jre. This may change over time, this is a configurable item here. 
export _oracle_java_url="https://download.oracle.com/java/20/latest/jdk-20_linux-x64_bin.tar.gz"

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Preferred Zorin OS mirrors for ISO downloads. Ordered in the same sequence presented on
# https://zorin.com/os/download/18/core/ so the scripts try geographically distributed mirrors first.
KVM_ZORIN_ISO_MIRRORS=(
	"https://distro.ibiblio.org/pub/linux/distributions/zorinos/"
	"https://mirror.clarkson.edu/zorinos/isos/"
	"https://mirror.webworld.ie/zorinos/"
	"https://mirror.metanet.ch/zorinos/"
	"https://ftp.halifax.rwth-aachen.de/zorinos/"
	"https://mirror.23m.com/zorinos/isos/"
	"https://mirror.dogado.de/zorinos/"
	"https://mirror.serverion.com/zorinos/"
	"https://mirrors.dotsrc.org/zorinos/"
	"https://ftpmirror2.infania.net/mirror/zorinos/isos/"
	"https://mirror.kumi.systems/zorinos/"
	"https://mirror.ihost.md/zorinos/"
	"https://mirror.hosthink.net/zorinos/"
	"https://mirror.nju.edu.cn/zorinos/"
)

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Set location to backup virtual machines to. This location must have addequate space
# to store several copies of the virtual machine disks. This may be a network share or
# an external storage or san mount point. If you do non need to backup VMs you can set
# this to blank or ignore it. If you do not have QEMU/KVM installed selecting this
# option to back up Virtual Machines in the menu will do nothing.
VM_BACKUP_TARGET="/mnt/vmdsk/VM_BACKUP"

# ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Set location to store created virtual machine disk images. This location must have
# adequate space to store several copies of the virtual machine disks. This may be a
# network share or an external storage or san mount point. If you do not have QEMU/KVM
# installed selecting this option to build Virtual Machines in the menu will do nothing.
VM_BUILD_TARGET="${VM_BUILD_TARGET:="/mnt/vmdsk/VM_IMAGES"}"

# Set the default initial virtual machine disk size in GB. This may be overidden
# during the virtual machine build process. The disk size will expand as required up to
# the maximum size set during the VM build process (example: 100GB).
INITIAL_VM_DISK_ALLOC_GB=32

# VM build default settings for unattended installs.
_ENCRYPT_DISK="YES"
_TEMP_DISK_PASSWORD="letmein1234"
_OEM_USER="tangarora"
_OEM_USER_FULLNAME="RTD User"
_OEM_USER_GROUP="sudo"
_OEM_USER_PASSWORD="letmein1234"
_OEM_USER_KEYBOARD_LAYOUT="us"
_OEM_USER_LANGUAGE="en_US"
_OEM_TIME_ZONE="Etc/UTC"
_OEM_WIRELESS_ID="loader"
_OEM_WIRELESS_PASSWORD="letmein1234"
_role="default"
_OEM_COPY_SSH_KEY="NO"

# VM default settings for memory and cpu allocation if nothing is specified during the VM build process.
# T-Shirt sizing for VM builds - small, medium, large, xl, xxl etc.
# These settings may be overidden during the VM build process.
# Format: CPU cores, RAM in MB, Disk size in GB
# These are used as presets for quick selection during the VM build process.
# For example, a small VM will have 2 CPU cores, 2048 MB of RAM and 100 GB disk size.
# These are used in a function like so: 
# kvm::make_vm_now_from_ubuntu_com --role VDI --server-app kubuntu-desktop --ask YES --tshirt-size medium if
# the _rtd_library is loaded.
_OEM_USER_VM_SIZE_PREFERENCES="${_USER_CONFIG_DIR}/vm_user_build_defaults.info"
DEFAULT_VM_MEMORY_MB=2048
DEFAULT_VM_CPU_COUNT=2
DEFAULT_VM_DISK_SIZE_GB=100
_TSHIRT_CPU_SMALL=2
_TSHIRT_MEM_SMALL=2048
_TSHIRT_DSK_SMALL=100
_TSHIRT_CPU_MEDIUM=4
_TSHIRT_MEM_MEDIUM=4096
_TSHIRT_DSK_MEDIUM=100
_TSHIRT_CPU_LARGE=8
_TSHIRT_MEM_LARGE=8192
_TSHIRT_DSK_LARGE=100
_TSHIRT_CPU_XL=16
_TSHIRT_MEM_XL=16384
_TSHIRT_DSK_XL=100
_TSHIRT_CPU_XXL=32
_TSHIRT_MEM_XXL=32768
_TSHIRT_DSK_XXL=100

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Set where desktop wallpapers are stored if not already defined
: ${_XDG_WALLPAPER_DIR:="/usr/share/wallpapers"} ; export _XDG_WALLPAPER_DIR

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Sometimes, depending on distribution of Linux, some paths are omitted fom the path statement
# for the root user. This can break scripts. Therefore we add back some paths here if they are
# not already present.
hash snap &>/dev/null && if ! echo $PATH |grep /snap/bin ; then export PATH=$PATH:/snap/bin ; fi &>/dev/null


#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Debian provides several sources that may be used to install software from including the operating system.
# These sources will be used to build virtual machines from.
# _DEBIAN_SOURCE_URL is the location of the debian installer files.
# _DEBIAN_FRONTEND_GTK_KERNEL is the location of the kernel to use for the graphical installer.
# _DEBIAN_FRONTEND_GTK_INITRD is the location of the initrd to use for the graphical installer.
# _DEBIAN_FRONTEND_DEFAULT_KERNEL is the location of the kernel to use for the text installer.
# _DEBIAN_FRONTEND_DEFAULT_INITRD is the location of the initrd to use for the text installer.
# SOURCE_ISO_URL is the location of the debian iso file to use for the virtual machine. (the latest will be selected automatically)
# SOURCE_FIRMWARE is the location of the debian firmware to use for the virtual machine (extra drivers).

export _DEBIAN_SOURCE_URL="http://ftp.us.debian.org/debian/dists/stable/main/installer-amd64/"
export _DEBIAN_FRONTEND_GTK_KERNEL="${_DEBIAN_SOURCE_URL}/current/images/netboot/gtk/debian-installer/amd64/linux"
export _DEBIAN_FRONTEND_GTK_INITRD="${_DEBIAN_SOURCE_URL}/current/images/netboot/gtk/debian-installer/amd64/initrd.gz"
export _DEBIAN_FRONTEND_DEFAULT_KERNEL="${_DEBIAN_SOURCE_URL}/current/images/netboot/debian-installer/amd64/linux"
export _DEBIAN_FRONTEND_DEFAULT_INITRD="${_DEBIAN_SOURCE_URL}/current/images/netboot/debian-installer/amd64/initrd.gz"

# The following lines are no longer required as the latest firmware and ISO are included the lates Debian installer automatically.
# Uncomment if you want to use older versions of Debian.
# export _SOURCE_ISO_URL="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/$(curl --silent  https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA256SUMS | \grep -o "debian-.*netinst*.iso" |grep -v mac |grep -v edu)"
# export _SOURCE_FIRMWARE="http://cdimage.debian.org/cdimage/unofficial/non-free/firmware/buster/current/firmware.zip"
# export _CURRENT_DEB_ISO="$(curl --silent  https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA256SUMS | \grep -o "debian-.*netinst*.iso" |grep -v mac |grep -v edu)"

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Suse VM build default sources.
export _DEFAULT_SUSE_VER="15.5"
export _SUSE_LEAP_SOURCE="https://download.opensuse.org/distribution/openSUSE-current/repo/oss/"
export _SUSE_TUMBLEWEED_SOURCE="https://download.opensuse.org/tumbleweed/repo/oss/"
# Backward compatibility for historical typo
export _SUSE_TUBMLEWEED_SOURCE="${_SUSE_TUMBLEWEED_SOURCE}"
export _SUSE_PACKMAN_LEAP="https://ftp.gwdg.de/pub/linux/misc/packman/suse/openSUSE_Leap_${_DEFAULT_SUSE_VER}/"
export _SUSE_PACKMAN_TUMBLEWEED="https://ftp.gwdg.de/pub/linux/misc/packman/suse/openSUSE_Tumbleweed/"
export _SUSE_NON_OSS_LEAP="https://download.opensuse.org/distribution/openSUSE-current/repo/non-oss/"
export _SUSE_NON_OSS_TUMBLEWEED="https://download.opensuse.org/tumbleweed/repo/non-oss/"

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# Fedora VM default build sources
# NOTE: Fedora sources automatically set. To override the internal functions and preferences you may uncomment the following line: 
# export _DEFAULT_FEDORA_VER="39"

# To override the internal functions and preferences you may uncomment the following 2 lines:
# export _mirrorlist_url="https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-${_DEFAULT_FEDORA_VER}&arch=x86_64"
# export _source_url="https://dl.fedoraproject.org/pub/fedora/linux/releases/${_DEFAULT_FEDORA_VER}/Everything/x86_64/os/"

# Additional Fedora repos for use: 
# repo --name=fedora-updates --mirrorlist="https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f${_DEFAULT_FEDORA_VER}&arch=x86_64" --cost=0
# repo --name=rpmfusion-free --mirrorlist="https://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-${_DEFAULT_FEDORA_VER}&arch=x86_64" --includepkgs=rpmfusion-free-release
# repo --name=rpmfusion-free-updates --mirrorlist="https://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-updates-released-${_DEFAULT_FEDORA_VER}&arch=x86_64" --cost=0
# repo --name=rpmfusion-nonfree --mirrorlist="https://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-${_DEFAULT_FEDORA_VER}&arch=x86_64" --includepkgs=rpmfusion-nonfree-release
# repo --name=rpmfusion-nonfree-updates --mirrorlist="https://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-updates-released-${_DEFAULT_FEDORA_VER}&arch=x86_64" --cost=0

#::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
# RedHat VM default build sources
export _DEFAULT_REDHAT_VER="10"

# repo --name="alamalinux${_DEFAULT_REDHAT_VER}-baseos" --baseurl="https://repo.almalinux.org/almalinux/${_DEFAULT_REDHAT_VER}/BaseOS/x86_64/os/" --mirrorlist=""
# repo --name="alamalinux${_DEFAULT_REDHAT_VER}-appstream" --baseurl="https://repo.almalinux.org/almalinux/${_DEFAULT_REDHAT_VER}/AppStream/x86_64/os/" --mirrorlist=""
# repo --name="epel${_DEFAULT_REDHAT_VER}-everything" --baseurl="" --mirrorlist="https://mirrors.fedoraproject.org/mirrorlist?repo=epel-${_DEFAULT_REDHAT_VER}&arch=x86_64"

# Define launcher data:
# The RTD launcher generator reads the key/value blocks below to build .desktop files.
# Format:
#   file_base=<unique desktop filename base>
#   name=<menu display name>
#   comment=<tooltip/description>
#   module_dir=<module directory under ${_MODS_DIR}>
#   script=<executable relative to module_dir>
#   icon=<icon relative to module_dir>
#   terminal=<true|false>
# Separate launcher entries with a blank line. Lines starting with # are ignored.
read -r -d '' LAUNCHER_DATA <<'EOF'
# RTD Simple System Support Tool
file_base=rtd
name=RTD
comment=RTD Simple System Support Tool
module_dir=simple-support-tool.mod
script=rtd-simple-support-tool
icon=Media_files/sys2.ico
terminal=true

# RTD User Backup Tool
file_base=rtd-user-bakup
name=RTD-Backup
comment=RTD User home Backup Tool
module_dir=system-user-backup.mod
script=rtd-oem-backup-linux-config
icon=Media_files/sys0.ico
terminal=true

# NordVPN Manager
file_base=rtd-nordvpn
name=RTD-NordVPN
comment=Nord VPN Terminal GUI
module_dir=nordvpn-manager.mod
script=rtd-nordvpn
icon=Media_files/sys3.ico
terminal=true

# Minecraft Server Manager
file_base=rtd-minercraft-server
name=Minecraft-Server
comment=Automatically download and start a Minecraft Server here now!
module_dir=minecraft-server-manager.mod
script=rtd-minecraft-server
icon=Media_files/sys5.ico
terminal=true

# Desktop Look Switcher
file_base=rtd-switch-desktop
name=RTD UI Look Changer
comment=Change the overall look and feel of your desktop (be more like Windows or MAC)
module_dir=rtd-desktop-look-switcher.mod
script=rtd-desktop-look-switcher
icon=Media_files/sys7.ico
terminal=true

# Software Bundle Manager
file_base=rtd-software-bundle-manager
name=RTD Software Bundle Manager
comment=Add and remove bundles of software by task to your computer.
module_dir=oem-bundle-manager.mod
script=rtd-oem-bundle-manager
icon=image/software.ico
terminal=true

# Hardware Information Viewer
file_base=rtd-hardware-information
name=RTD Hardware Information Viewer
comment=View detailed hardware information about this computer.
module_dir=system-hardware-information.mod
script=rtd-system-hardware-information
icon=image/system-information-icon-3.png
terminal=false

# OEM App Runner
file_base=rtd-app-runner
name=RTD OEM Special App Runner
comment=Run Specialized OEM Applications safely and reliably.
module_dir=oem-app-runner.mod
script=rtd-oem-app-runner
icon=image/App-launcher.jpg
terminal=true
EOF
